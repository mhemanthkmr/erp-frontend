import{aB as L,aA as N,an as T,a as o,am as t,aC as $,aG as w}from"./index-NNRCG9Rm.js";import{V as b,a9 as g,ad as D,O as I,a8 as C,a6 as E,a7 as P}from"./IdurarOs-hOF3usfi.js";import"./index-vCtOLfRs.js";import{a as B,b as M,c as O,E as Y}from"./selectors-ODi0nExu.js";import{e as f}from"./actions-NDaFrLo5.js";import{P as k}from"./index-nierwHcH.js";import{s as v}from"./index-xrkCjAY0.js";import{u as G}from"./useDate-Fz8rfIL3.js";import{P as H,F as W}from"./PaymentForm-SkwH0oi9.js";import{c as S}from"./calculate-xJ0-_hck.js";import{t as _}from"./statusTagColor-sG5xH6CK.js";import{T as A}from"./index-ntKD6FMB.js";import{D as m}from"./index-bUsKcndE.js";import{C as q}from"./CloseCircleOutlined-agQ2nFs_.js";import"./ErpApp-og-vdlRX.js";import"./currency.es--or6eeOG.js";import"./index-57783YB8.js";import"./useFetch-3iL7NbWa.js";import"./color-tz1ocuTw.js";import"./index-hp3l0IZ8.js";import"./index-CdW27EVe.js";function z({config:i}){const a=L(),s=b();let{entity:n}=i;const c=N(),{isLoading:u,isSuccess:d,current:r}=T(B),[h]=g.useForm(),[e,j]=o.useState(0);o.useEffect(()=>{if(r){const{credit:l,total:p,discount:x}=r;j(S.sub(S.sub(p,x),l))}},[r]),o.useEffect(()=>{d&&(h.resetFields(),c(f.resetAction({actionType:"recordPayment"})),c(f.list({entity:n})),a(`/${n}/`))},[d]);const y=l=>{if(r){const{_id:p}=r,x=r.client&&r.client._id;l={...l,invoice:p,client:x}}c(f.recordPayment({entity:"payment",jsonData:l}))};return t.jsx(D,{isLoading:u,children:t.jsxs(g,{form:h,layout:"vertical",onFinish:y,children:[t.jsx(H,{maxAmount:e}),t.jsx(g.Item,{children:t.jsx(I,{type:"primary",htmlType:"submit",children:s("Record Payment")})})]})})}function J({config:i,currentItem:a}){var p,x;const s=b(),{entity:n,ENTITY_NAME:c}=i,u=G(),d=L(),[r,h]=o.useState([]),[e,j]=o.useState(a),[y,l]=o.useState({});return o.useEffect(()=>{e!=null&&e.client&&l(e.client[e.client.type])},[e]),o.useEffect(()=>{const F=new AbortController;if(a){const{items:R}=a;h(R),j(a)}return()=>F.abort()},[a]),o.useEffect(()=>{console.info("itemslist",r)},[r]),t.jsxs(t.Fragment,{children:[t.jsx(C,{gutter:[12,12],children:t.jsxs(E,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[t.jsx(k,{onBack:()=>d(`/${n.toLowerCase()}`),title:`Record Payment for ${c} # ${e.number}/${e.year||""}`,ghost:!1,tags:t.jsx(A,{color:(p=_(e.paymentStatus))==null?void 0:p.color,children:e.paymentStatus&&s(e.paymentStatus)}),extra:[t.jsx(I,{onClick:()=>{d(`/${n.toLowerCase()}`)},icon:t.jsx(q,{}),children:s("Cancel")},`${v.generate()}`),t.jsx(I,{onClick:()=>d(`/invoice/read/${e._id}`),icon:t.jsx(W,{}),children:s("Show Invoice")},`${v.generate()}`)],style:{padding:"20px 0px"}}),t.jsx(P,{dashed:!0})]})}),t.jsxs(C,{gutter:[12,12],children:[t.jsxs(E,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[t.jsx("div",{className:"space50"}),t.jsxs(m,{title:`${s("Client")}  : ${e.client.name}`,column:1,children:[t.jsx(m.Item,{label:s("email"),children:y.email}),t.jsx(m.Item,{label:s("phone"),children:y.phone}),t.jsx(P,{dashed:!0}),t.jsx(m.Item,{label:s("payment status"),children:t.jsx(A,{color:(x=_(e.paymentStatus))==null?void 0:x.color,children:e.paymentStatus&&s(e.paymentStatus)})}),t.jsx(m.Item,{label:s("sub total"),children:u.amountFormatter({amount:e.subTotal})}),t.jsx(m.Item,{label:s("total"),children:u.amountFormatter({amount:e.total})}),t.jsx(m.Item,{label:s("discount"),children:u.amountFormatter({amount:e.discount})}),t.jsx(m.Item,{label:s("Balance"),children:u.amountFormatter({amount:e.credit})})]})]}),t.jsx(E,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:t.jsx(z,{config:i})})]})]})}function K({config:i}){const a=N(),{id:s}=$();let n=T(M(s));o.useEffect(()=>{a(n?f.currentItem({data:n}):f.read({entity:i.entity,id:s}))},[n,s]);const{result:c}=T(O);return n=c,o.useEffect(()=>{a(f.currentAction({actionType:"recordPayment",data:n}))},[n]),t.jsx(Y,{children:n?t.jsx(J,{config:i,currentItem:c}):t.jsx(w,{})})}function ht(){const i="invoice",a=b(),s={PANEL_TITLE:a("invoice"),DATATABLE_TITLE:a("invoice_list"),ADD_NEW_ENTITY:a("add_new_invoice"),ENTITY_NAME:a("invoice"),RECORD_ENTITY:a("record_payment")},n={entity:i,...s};return t.jsx(K,{config:n})}export{ht as default};
