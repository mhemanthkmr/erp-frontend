import{aA as R,aB as U,an as q,a as u,aC as B,am as a}from"./index-NNRCG9Rm.js";import{d,P as O}from"./index-nierwHcH.js";import{V as A,a9 as D,O as L,a7 as I,ad as Z}from"./IdurarOs-hOF3usfi.js";import{e as T}from"./actions-NDaFrLo5.js";import{c as b}from"./calculate-xJ0-_hck.js";import{s as F}from"./index-xrkCjAY0.js";import{d as N}from"./selectors-ODi0nExu.js";import{t as Y}from"./statusTagColor-sG5xH6CK.js";import{T as E}from"./index-ntKD6FMB.js";import{C as z}from"./CloseCircleOutlined-agQ2nFs_.js";import{P as G}from"./PlusOutlined-RgQQQ1Jv.js";function J({form:l,translate:x}){const s=()=>{l.submit()};return a.jsx(L,{onClick:s,type:"primary",icon:a.jsx(G,{}),children:x("update")})}function rt({config:l,UpdateForm:x}){var j,C;const s=A();let{entity:p}=l;const g=R(),f=U(),{current:n,isLoading:$,isSuccess:S}=q(N),[i]=D.useForm(),[v,h]=u.useState(0),H={status:"",client:{name:"",email:"",phone:"",address:""},subTotal:0,taxTotal:0,taxRate:0,total:0,credit:0,number:0,year:0},[o,P]=u.useState(n??H),{id:y}=B(),k=(t,e)=>{const c=e.items;let r=0;c&&(c.map(m=>{if(m&&m.quantity&&m.price){let M=b.multiply(m.quantity,m.price);r=b.add(r,M)}}),h(r))},w=t=>{let e={...t};if(t&&((t.date||t.expiredDate)&&(e.date=d(t.date).format("YYYY-MM-DDTHH:mm:ss.SSSZ"),e.expiredDate=d(t.expiredDate).format("YYYY-MM-DDTHH:mm:ss.SSSZ")),t.items)){let c=[...t.items];c.map(r=>{r.total=r.quantity*r.price}),e.items=c}g(T.update({entity:p,id:y,jsonData:e}))};return u.useEffect(()=>{S&&(i.resetFields(),h(0),g(T.resetAction({actionType:"update"})),f(`/${p.toLowerCase()}/read/${y}`))},[S]),u.useEffect(()=>{if(n){P(n);let t={...n};t.date&&(t.date=d(t.date)),t.expiredDate&&(t.expiredDate=d(t.expiredDate)),t.taxRate||(t.taxRate=0);const{subTotal:e}=t;i.resetFields(),i.setFieldsValue(t),h(e)}},[n]),a.jsxs(a.Fragment,{children:[a.jsx(O,{onBack:()=>{f(`/${p.toLowerCase()}`)},title:s("update"),ghost:!1,tags:[a.jsx(E,{color:(j=Y(o.status))==null?void 0:j.color,children:o.status&&s(o.status)},"status"),o.paymentStatus&&a.jsx(E,{color:(C=Y(o.paymentStatus))==null?void 0:C.color,children:o.paymentStatus&&s(o.paymentStatus)},"paymentStatus")],extra:[a.jsx(L,{onClick:()=>{f(`/${p.toLowerCase()}`)},icon:a.jsx(z,{}),children:s("Cancel")},`${F.generate()}`),a.jsx(J,{translate:s,form:i},`${F.generate()}`)],style:{padding:"20px 0px"}}),a.jsx(I,{dashed:!0}),a.jsx(Z,{isLoading:$,children:a.jsx(D,{form:i,layout:"vertical",onFinish:w,onValuesChange:k,children:a.jsx(x,{subTotal:v,current:n})})})]})}export{rt as U};
