import{an as F,am as e,a as r}from"./index-NNRCG9Rm.js";import{d as g}from"./index-nierwHcH.js";import{A as E}from"./index-n3orj99K.js";import{I as O,M as m}from"./index-OAM2ZQLg.js";import{s as v}from"./ErpApp-og-vdlRX.js";import{a as P}from"./useDate-Fz8rfIL3.js";import{V as Q,a8 as u,a6 as s,a9 as a,ab as _,aa as Y,a7 as y,O as w}from"./IdurarOs-hOF3usfi.js";import{c as x}from"./calculate-xJ0-_hck.js";import{S as M}from"./index-57783YB8.js";import{I as b}from"./index-hp3l0IZ8.js";import{D as N}from"./index-CdW27EVe.js";import{P as I}from"./PlusOutlined-RgQQQ1Jv.js";function se({subTotal:l=0,current:i=null}){const{last_quote_number:t}=F(v);return t?e.jsx(B,{subTotal:l,current:i}):e.jsx(e.Fragment,{})}function B({subTotal:l=0,current:i=null}){const t=Q(),{dateFormat:p}=P(),{last_quote_number:S}=F(v),[R,T]=r.useState(()=>S+1),[D,q]=r.useState(0),[c,j]=r.useState(0),[L,V]=r.useState(0),[A,C]=r.useState(()=>new Date().getFullYear()),k=n=>{j(n/100)};r.useEffect(()=>{if(i){const{taxRate:n=0,year:o,number:d}=i;j(n/100),C(o),T(d)}},[i]),r.useEffect(()=>{const n=x.add(x.multiply(l,c),l);V(Number.parseFloat(x.multiply(l,c))),q(Number.parseFloat(n))},[l,c]);const h=r.useRef(!1);return r.useEffect(()=>{h.current.click()},[]),e.jsxs(e.Fragment,{children:[e.jsxs(u,{gutter:[12,0],children:[e.jsx(s,{className:"gutter-row",span:9,children:e.jsx(a.Item,{name:"client",label:t("Client"),rules:[{required:!0}],children:e.jsx(E,{entity:"client",displayLabels:["name"],searchFields:"name"})})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(a.Item,{label:t("number"),name:"number",initialValue:R,rules:[{required:!0}],children:e.jsx(b,{min:1,style:{width:"100%"}})})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(a.Item,{label:t("year"),name:"year",initialValue:A,rules:[{required:!0}],children:e.jsx(b,{style:{width:"100%"}})})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(a.Item,{label:t("status"),name:"status",rules:[{required:!1}],initialValue:"draft",children:e.jsx(_,{options:[{value:"draft",label:t("Draft")},{value:"pending",label:t("Pending")},{value:"sent",label:t("Sent")},{value:"accepted",label:t("Accepted")}]})})}),e.jsx(s,{className:"gutter-row",span:9,children:e.jsx(a.Item,{label:t("Note"),name:"note",children:e.jsx(Y,{})})}),e.jsx(s,{className:"gutter-row",span:8,children:e.jsx(a.Item,{name:"date",label:t("Date"),rules:[{required:!0,type:"object"}],initialValue:g(),children:e.jsx(N,{style:{width:"100%"},format:p})})}),e.jsx(s,{className:"gutter-row",span:7,children:e.jsx(a.Item,{name:"expiredDate",label:t("Expire Date"),rules:[{required:!0,type:"object"}],initialValue:g().add(30,"days"),children:e.jsx(N,{style:{width:"100%"},format:p})})})]}),e.jsx(y,{dashed:!0}),e.jsxs(u,{gutter:[12,12],style:{position:"relative"},children:[e.jsx(s,{className:"gutter-row",span:5,children:e.jsx("p",{children:t("Item")})}),e.jsx(s,{className:"gutter-row",span:7,children:e.jsx("p",{children:t("Description")})}),e.jsxs(s,{className:"gutter-row",span:3,children:[e.jsx("p",{children:t("Quantity")})," "]}),e.jsx(s,{className:"gutter-row",span:4,children:e.jsx("p",{children:t("Price")})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx("p",{children:t("Total")})})]}),e.jsx(a.List,{name:"items",children:(n,{add:o,remove:d})=>e.jsxs(e.Fragment,{children:[n.map(f=>e.jsx(O,{remove:d,field:f,current:i},f.key)),e.jsx(a.Item,{children:e.jsx(w,{type:"dashed",onClick:()=>o(),block:!0,icon:e.jsx(I,{}),ref:h,children:t("Add field")})})]})}),e.jsx(y,{dashed:!0}),e.jsxs("div",{style:{position:"relative",width:" 100%",float:"right"},children:[e.jsxs(u,{gutter:[12,-5],children:[e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(a.Item,{children:e.jsx(w,{type:"primary",htmlType:"submit",icon:e.jsx(I,{}),block:!0,children:t("Save")})})}),e.jsx(s,{className:"gutter-row",span:4,offset:10,children:e.jsxs("p",{style:{paddingLeft:"12px",paddingTop:"5px"},children:[t("Sub Total")," :"]})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(m,{readOnly:!0,value:l})})]}),e.jsxs(u,{gutter:[12,-5],children:[e.jsx(s,{className:"gutter-row",span:4,offset:15,children:e.jsx(a.Item,{name:"taxRate",rules:[{required:!0}],children:e.jsx(M,{value:c,onChange:k,entity:"taxes",outputValue:"taxValue",displayLabels:["taxName"],withRedirect:!0,urlToRedirect:"/taxes",redirectLabel:"Add New Tax"})})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(m,{readOnly:!0,value:L})})]}),e.jsxs(u,{gutter:[12,-5],children:[e.jsx(s,{className:"gutter-row",span:4,offset:15,children:e.jsxs("p",{style:{paddingLeft:"12px",paddingTop:"5px"},children:[t("Total")," :"]})}),e.jsx(s,{className:"gutter-row",span:5,children:e.jsx(m,{readOnly:!0,value:D})})]})]})]})}export{se as Q};
