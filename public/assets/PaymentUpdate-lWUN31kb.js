import{aB as w,aA as D,an as P,a as m,am as t,aC as I,aG as B}from"./index-NNRCG9Rm.js";import{V as F,a9 as E,ad as U,O as _,a8 as L,a6 as C,a7 as A}from"./IdurarOs-hOF3usfi.js";import"./index-vCtOLfRs.js";import{d as M,b as R,s as k,E as v}from"./selectors-ODi0nExu.js";import{e as g}from"./actions-NDaFrLo5.js";import{d as O,P as Y}from"./index-nierwHcH.js";import{s as S}from"./index-xrkCjAY0.js";import{u as G}from"./useDate-Fz8rfIL3.js";import{c as y}from"./calculate-xJ0-_hck.js";import{P as H,F as V}from"./PaymentForm-SkwH0oi9.js";import{t as N}from"./statusTagColor-sG5xH6CK.js";import{T as $}from"./index-ntKD6FMB.js";import{D as l}from"./index-bUsKcndE.js";import{C as W}from"./CloseCircleOutlined-agQ2nFs_.js";import"./ErpApp-og-vdlRX.js";import"./currency.es--or6eeOG.js";import"./index-57783YB8.js";import"./useFetch-3iL7NbWa.js";import"./color-tz1ocuTw.js";import"./index-hp3l0IZ8.js";import"./index-CdW27EVe.js";function q({config:o,currentInvoice:s}){const a=F(),n=w();let{entity:c}=o;const r=D(),{isLoading:p,isSuccess:e}=P(M),[u]=E.useForm(),[j,T]=m.useState(0);m.useEffect(()=>{if(s){const{credit:i,total:x,discount:h,amount:b}=s;T(y.sub(y.sub(x,h),y.sub(y.sub(i,b))));const d={...s};d.date&&(d.date=O(d.date)),u.setFieldsValue(d)}},[s]),m.useEffect(()=>{e&&(u.resetFields(),r(g.resetAction({actionType:"recordPayment"})),r(g.list({entity:c})),n(`/${c.toLowerCase()}/read/${s._id}`))},[e]);const f=i=>{if(s){const{_id:x}=s,h=s.client&&s.client._id;i={...i,invoice:x,client:h}}r(g.update({entity:c,id:s._id,jsonData:i}))};return t.jsx(t.Fragment,{children:t.jsx(U,{isLoading:p,children:t.jsxs(E,{form:u,layout:"vertical",onFinish:f,children:[t.jsx(H,{maxAmount:j}),t.jsx(E.Item,{children:t.jsx(_,{type:"primary",htmlType:"submit",children:a("Update")})})]})})})}function z({config:o,currentItem:s}){var f,i;const a=F(),{entity:n,ENTITY_NAME:c}=o,r=G(),p=w(),[e,u]=m.useState(s);m.useEffect(()=>{const x=new AbortController;if(s){const{invoice:h,_id:b,...d}=s;u({...d,...h,_id:b})}return()=>x.abort()},[s]);const[j,T]=m.useState({});return m.useEffect(()=>{e!=null&&e.client&&T(e.client[e.client.type])},[e]),t.jsxs(t.Fragment,{children:[t.jsx(L,{gutter:[12,12],children:t.jsxs(C,{className:"gutter-row",xs:{span:24},sm:{span:24},md:{span:24},lg:{span:20,push:2},children:[t.jsx(Y,{onBack:()=>p(`/${n.toLowerCase()}`),title:`Update  ${c} # ${e.number}/${e.year||""}`,ghost:!1,tags:t.jsx($,{color:(f=N(e.paymentStatus))==null?void 0:f.color,children:e.paymentStatus}),extra:[t.jsx(_,{onClick:()=>{p(`/${n.toLowerCase()}`)},icon:t.jsx(W,{}),children:a("Cancel")},`${S.generate()}`),t.jsx(_,{onClick:()=>p(`/invoice/read/${e._id}`),icon:t.jsx(V,{}),children:a("Show invoice")},`${S.generate()}`)],style:{padding:"20px 0px"}}),t.jsx(A,{dashed:!0})]})}),t.jsxs(L,{gutter:[12,12],children:[t.jsxs(C,{className:"gutter-row",xs:{span:24,order:2},sm:{span:24,order:2},md:{span:10,order:2,push:2},lg:{span:10,order:2,push:4},children:[t.jsx("div",{className:"space50"}),t.jsxs(l,{title:`${a("Client")} : ${e.client.name}`,column:1,children:[t.jsx(l.Item,{label:a("email"),children:j.email}),t.jsx(l.Item,{label:a("Phone"),children:j.phone}),t.jsx(A,{dashed:!0}),t.jsx(l.Item,{label:a("Payment Status"),children:t.jsx($,{color:(i=N(e.paymentStatus))==null?void 0:i.color,children:e.paymentStatus})}),t.jsx(l.Item,{label:a("SubTotal"),children:r.amountFormatter({amount:e.subTotal})}),t.jsx(l.Item,{label:a("Total"),children:r.amountFormatter({amount:e.total})}),t.jsx(l.Item,{label:"Discount",children:r.amountFormatter({amount:e.discount})}),t.jsx(l.Item,{label:"Balance",children:r.amountFormatter({amount:e.credit})})]})]}),t.jsx(C,{className:"gutter-row",xs:{span:24,order:1},sm:{span:24,order:1},md:{span:12,order:1},lg:{span:10,order:1,push:2},children:t.jsx(q,{config:o,currentInvoice:e})})]})]})}function J({config:o}){const s=D(),{id:a}=I();let n=P(R(a));const{result:c}=P(k),r=n?{...n}:{...c};return m.useLayoutEffect(()=>{s(g.currentAction({actionType:"update",id:a,data:r}))},[]),t.jsx(v,{children:n?t.jsx(z,{config:o,currentItem:n}):t.jsx(B,{})})}function ft(){const o=F(),s="payment",a={PANEL_TITLE:o("payment"),DATATABLE_TITLE:o("payment_list"),ADD_NEW_ENTITY:o("add_new_payment"),ENTITY_NAME:o("payment")},n={entity:s,...a};return t.jsx(J,{config:n})}export{ft as default};
